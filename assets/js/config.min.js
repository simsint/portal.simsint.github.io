sessionStorage.clear(),window._config={cognito:{userPoolId:"us-east-1_InedFezwr",region:"us-east-1",clientId:"2g2q4svd2pg3lro7jv9ae5q59h"}};let poolData={UserPoolId:_config.cognito.userPoolId,ClientId:_config.cognito.clientId};const CORS="",ENDPOINT="https://api.ahmedalnajjar.com/dev",bootstrapCDN='<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css">',style="<style>\n                @media print {\n                  .sticky-footer {\n                      position: fixed;\n                      bottom: 0;\n                  }\n                }\n              </style>";function resizeIframe(t){t.style.height=t.contentWindow.document.documentElement.scrollHeight+"px",t.scrolling="no"}function successToast(t){$.toast({icon:"success",text:`<p class='p-3'>${t}</p>`,delay:"3000",position:"top-right",dismissible:!1})}function warningToast(t){$.toast({icon:"warning",text:`<p class='p-3'>${t}</p>`,delay:"3000",position:"top-right",dismissible:!1})}function dangerToast(t){$.toast({icon:"danger",text:`<p class='p-3'>${t}</p>`,delay:"3000",position:"top-right",dismissible:!1})}function submitForms(t){console.log(form2js("forms",".",!0,null));var e=form2js("forms",".",!0,null);e.email=sessionStorage.getItem("pt-email"),console.log(e),$.ajax({url:`${ENDPOINT}/users/${sessionStorage.getItem("pid")}/forms`,method:"POST",contentType:"application/json",data:JSON.stringify(e),processing:!1}).done((function(t){console.log(t),successToast("Submitted Successfully")})).fail((function(t){console.log(t)}))}function ptRenderChecklist(){200==data.statusCode&&drawChart(data.body.Items[0].survey)}function ptShowUserReport(t){getResponse(`/users/${sessionStorage.getItem("pid")}/checklist`,{email:sessionStorage.getItem("pt-email"),created:t},ptRenderChecklist)}function ptViewUserReportsList(t){$("#user-report-list").html(""),t.body.Items.forEach(t=>{$(`<li class="p-3 text-white text-uppercase mb-1 pointer action" style="background-color: #b5b5b5;" data-action="view-user-report" data-created="${t.created}">\n          <span>${moment(t.created).format("LLL")}</span>\n        </li>`).appendTo("#user-report-list")})}function ptUserReportsSection(){$(".sections").addClass("d-none"),$(".sections.view-user-reports").removeClass("d-none"),getResponse(`/users/${sessionStorage.getItem("pid")}/checklist`,{email:sessionStorage.getItem("pt-email")},ptViewUserReportsList)}function ptViewVisitDetailsList(t){$("#visit-details-list").html(""),t.body.Items.forEach(t=>{$(`<li class="p-3 text-white text-uppercase mb-1 pointer action" style="background-color: #b5b5b5;" data-action="view-form" data-form-type='${t.form_type}' data-created="${t.created}">\n          <span>${moment(t.created).format("LLL")}</span>\n        </li>`).appendTo("#visit-details-list")})}function ptVisitDetailsSection(){$(".sections").addClass("d-none"),$(".sections.view-visit-details").removeClass("d-none"),$("#visit-detail-iframe").attr("src","../forms/visit-report-form.html"),getResponse(`/users/${sessionStorage.getItem("pid")}/forms`,{email:sessionStorage.getItem("pt-email"),form_type:"visit_report_form"},ptViewVisitDetailsList)}function ptRenderForm(t){var e=t.body.Items[0].form_data;t.body.Items[0].form_type;let n="";delete e.email,delete e.form_type;for(const[t,s]of Object.entries(e))t.includes("file")||(t.includes("signature")&&!t.includes("date")?n+=`<p class="mb-1 bg-secoundary" style="font-size:18px"><span class="font-weight-bold" style="">${t.replaceAll("_"," ")}&nbsp: &nbsp</span> <img src="${s}" style="height:auto;width:350px;" /></p>`:n+=`<p class="mb-1 bg-secoundary" style="font-size:18px"><span class="font-weight-bold" style="">${t.replaceAll("_"," ")}&nbsp: &nbsp</span> ${s}</p>`);$("#user-report-data").html(n)}function ptShowForm(t,e){getResponse(`/users/${sessionStorage.getItem("pid")}/forms`,{email:sessionStorage.getItem("pt-email"),form_type:t,created:e},ptRenderForm)}function ptViewFormsList(t){$("#forms-list").html(""),t.body.Items.forEach(t=>{$(`<li class="p-3 text-white text-uppercase mb-1 pointer action" style="background-color: #b5b5b5;" data-action="view-form" data-form-type='${t.form_type}' data-created="${t.created}">\n          <span class="d-block mb-1 text-uppercase font-weight-bold">${t.form_type.replaceAll("_"," ")}</span>\n          <span>${moment(t.created).format("LLL")}</span>\n        </li>`).appendTo("#forms-list")})}function ptViewFormsSection(){$(".sections").addClass("d-none"),$(".sections.view-forms").removeClass("d-none"),getResponse(`/users/${sessionStorage.getItem("pid")}/forms`,{email:sessionStorage.getItem("pt-email")},ptViewFormsList)}function confirmAppointment(t){$.showConfirm({title:"Appointment Confirmation",body:"Do you want to confirm this appointment",textTrue:"CONFIRM",textFalse:"CANCEL",onSubmit:function(t){t&&$.toast({icon:"success",text:"<p class='p-3'>Appointment Confirmed</p>",delay:"3000",position:"top-right",dismissible:!1})}})}function showInvoice(t){getResponse("/admin/users",{filter_name:"sub",filter_value:t},null);var e=`<html><head>${bootstrapCDN}${style}</head><body>${renderInvoice()}</body></html>`;$.showModal({title:"INVOICE <button class='btn btn-sm btn-primary position-absolute print' style='right:50px;'>PRINT</button>",body:`<iframe id="printContent" name="printContent" height="500" srcdoc='${e}'></iframe>`});$("iframe#printContent").height();var n=$("iframe#printContent").parent().height(500);console.log(n)}function openPatientDashboard(t,e){window.location.href=`./patient/pt-dashboard.html?pid=${t}&eid=${e}`}function userProfileModal(t){$.showModal({title:"USER PROFILE",body:renderUserHtml(t.data[0])})}function getResponse(t,e,n){$.ajax({url:""+ENDPOINT+t,type:"get",dataType:"json",data:e,contentType:"application/json"}).done((function(t){n(t)})).fail((function(t){console.log("error -",t)}))}function getSyncResponse(t,e){$.ajax({url:""+ENDPOINT+t,type:"get",dataType:"json",data:e,async:!1,contentType:"application/json"}).done((function(t){return t})).fail((function(t){return console.log("error -",t),t}))}function findAge(t){return moment().diff(t,"years",!1)}function getUserName(t){return`${null!=t.given_name?t.given_name+" ":""}\n  ${null!=t.middle_name?t.middle_name+" ":""}\n  ${null!=t.family_name?t.family_name+" ":""}`}function renderUserHtml(t){return`<div class="row m-2 py-3 small rounded shadow">\n  <div class="col-sm-auto text-center"><img class="w-100" src=${null!=t.picture?t.picture:"./assets/img/user.svg"} style="max-width: 100px;" /></div>\n  <div class="col">\n      <div class="row">\n          <div class="col">\n              <h5 class="text-capitalize mb-0 font-weight-bold">${getUserName(t)}</h5>\n              <p>${t.email}</p>\n              <p class="mb-0"><strong>DOB</strong>:  ${null!=t.birthdate?t.birthdate:"-"}</p>\n              <p class="mb-0"><strong>Age</strong>: ${null!=t.birthdate?findAge(t.birthdate):"-"} Years</p>\n          </div>\n          <div class="col">\n              <p class="mb-0"><strong>Nationality</strong>: ${null!=t.locale?t.locale:"-"}</p>\n              <p class="mb-0"><strong>Phone</strong>: ${null!=t.phone_number?t.phone_number:"-"}</p>\n              <p class="mb-0"><strong>Address</strong>: ${null!=t.address?t.address:"-"}</p>\n              <p class="mb-0"><strong>Emirates ID</strong>: ${null!=t.preferred_username?t.preferred_username:"-"}</p>\n              <button class="btn btn-outline-primary action btn-sm m-1" type="button" data-action="pt-dashboard" data-id='${t.sub}'>PATIENT DASHBOARD</button>\n              <a class="btn btn-outline-primary btn-sm" href="#collapse-${t.sub}" role="button" aria-expanded="true" aria-controls="collapse-${t.sub}" data-toggle="collapse">View Emirates Card</a></div>\n      </div>\n  </div>\n  <div class="col-12 collapse" id="collapse-${t.sub}">\n      <div class="row mt-2">\n          <div class="col-sm-12 col-md-6 text-center"><img class="img-fluid" src="${emiratesResolver(t)}" /></div>\n          <div class="col-sm-12 col-md-6 text-center"><img class="img-fluid" src="${emiratesResolver(t)}" /></div>\n      </div>\n  </div>\n</div>`}function emiratesResolver(t){return"ykuk88@gmail.com"===t.email?"./assets/img/emirids/eidf_1612582523905.jpeg":"784198821417908"===t.preferred_name?"./assets/img/emirids/eidb_1612582523905.jpeg":"./assets/img/card-holder.png"}function eventTimeToString(t,e){return`${moment(t).format("LL")} - ${moment(e).format("LT")}`}function serviceDetails(t){return`${null!=t.service_type?t.service_type+" | ":""} \n  ${null!=t.service_amount?""+t.service_amount:""}\n  ${null!=t.service_currency?t.service_currency+" | ":""}\n  ${null!=t.service_duration?t.service_duration+" min | ":""}\n  ${null!=t.service_desc?t.service_desc+" ":""};\n  `}function renderAppointmentHtml(t){return htmlContent=`<div class="row m-1 py-3 small rounded shadow" >\n    <div class="col">\n        <div class="row">\n            <div class="col">\n                <p class="font-weight-bold mb-0" style="font-size:1rem;">Meeting with ${t.extendedProperties.private.patient_email||"-"}</p>\n                <p class="mb-2">${eventTimeToString(t.start.dateTime,t.end.dateTime)}</p>\n            </div>\n            <div class="col-auto">\n                <p class="mb-1"><strong>File No. </strong> ${t.extendedProperties.private.file_no}</p>\n            </div>\n        </div>\n        <p class="mb-1"><strong>Chief Complaint: </strong> ${t.extendedProperties.private.chief_complaint||"-"}</p>\n        <p class="mb-1"><strong>Location: </strong> ${t.location||"-"}</p>\n        <p class="mb-1"><strong>Service Details: </strong> ${serviceDetails(t.extendedProperties.private)} \n        </p>`,t.organizer.email==t.extendedProperties.private.creator_email?htmlContent+=`<p class="mb-0"><strong>Doctor: </strong>${t.organizer.displayName||t.organizer.email}</p>`:htmlContent+=`<p class="mb-0"><strong>Doctor: </strong>${t.organizer.email}</p>\n                    <p class="mb-1">Created By ${t.organizer.displayName||t.organizer.email}</p>`,htmlContent+=`<div class="row">\n                    <div class="col">\n                        <p class="mb-1"><strong>Status: </strong>${t.extendedProperties.private.status}</p>`,null!=t.extendedProperties.private.meeting_link&&(htmlContent+=`<p class="mb-1"><strong>Meeting: </strong><a href="${t.extendedProperties.private.meeting_link}" target="_blank" >Start Meeting</a></p>`),htmlContent+="</div>",htmlContent+='  <div class="col">',null!=t.extendedProperties.private.payment_ref&&(htmlContent+=`    <p class="mb-1"><strong>Payment Ref: </strong> ${t.extendedProperties.private.payment_ref} </p>`),null!=t.extendedProperties.private.amount&&(htmlContent+=`    <p class="mb-1"><strong>Payment Type: </strong> ${t.extendedProperties.private.payment_type} </p>`),htmlContent+="   </div>",htmlContent+=`</div>\n                <button class="btn btn-outline-primary action btn-sm m-1" type="button" data-action="profile" data-id='${t.extendedProperties.private.patient_id}'>USER PROFILE</button>`,"pending"==t.extendedProperties.private.status&&(htmlContent+=`<button class="btn btn-outline-primary action btn-sm m-1" type="button" data-action="confirm" data-id='${t.id}'>CONFIRM</button>`),null!=t.extendedProperties.private.payment_status&&"paid"==t.extendedProperties.private.payment_status&&(htmlContent+=`<button class="btn btn-outline-primary action btn-sm m-1" type="button" data-action="invoice" data-id='${t.id}' >INVOICE</button>`),htmlContent+=`<button class="btn btn-outline-primary action btn-sm m-1" type="button" data-action="reschedule" data-id='${t.id}'>RESCHEDULE</button>\n                <button class="btn btn-outline-primary action btn-sm m-1" type="button" data-action="pt-dashboard" data-id='${t.extendedProperties.private.patient_id}' data-eid='${t.id}'>PATIENT DASHBOARD</button>\n                </div>\n        </div>`,htmlContent}function renderInvoice(t){return'<footer class="sticky-footer w-100 text-center">\n                      <p class="mb-0 font-weight-bold">Araa Consultancy and Studies</p>\n                      <p class="mb-0">Unit 201, DBCS Building Al Gar houd 13866 Dubai 941, Tel: +971 ---------------</p>\n                      <p class="mb-0">Email: ahmedalnajjar@ahmedalnajjar.com web: www.ahmedalnajjar.com</p>\n                  </footer>','<div class="row">\n                      <div class="col-12 text-center"><img src="./assets/img/araa-consultancy-and-studies-logo.png" />\n                          <p class="mb-0">Experience Most Compassionate Healthcare in UAE</p>\n                          <p class="mb-0">Under the</p>\n                          <p class="font-weight-bold mb-5">Leadership of Dr. Ahmed Alnajjar</p>\n                      </div>\n                      <div class="col-12">\n                          <div class="row mb-5">\n                              <div class="col">\n                                  <p>Name: Mohammed Salman</p>\n                                  <p>Email : mohammedsalman0258@gmail.com</p>\n                                  <p>Age: 41 Years</p>\n                                  <p>Appointment : 30/1/2021 03:00 PM - 3:30 PM</p>\n                                  <p>Chief Complaint : Depression</p>\n                              </div>\n                              <div class="col-auto">\n                                  <p>File No. 168254858774</p>\n                                  <p>Doctor: Dr. Ahmed Alnajjar</p>\n                              </div>\n                          </div>\n                          <div class="table-responsive">\n                              <table class="table">\n                                  <thead>\n                                      <tr>\n                                          <th>Description</th>\n                                          <th>Price</th>\n                                      </tr>\n                                  </thead>\n                                  <tbody>\n                                      <tr>\n                                          <td>Video Call</td>\n                                          <td>500 AED</td>\n                                      </tr>\n                                  </tbody>\n                                  <tfoot>\n                                      <tr>\n                                          <td>Total</td>\n                                          <td>500 AED</td>\n                                      </tr>\n                                  </tfoot>\n                              </table>\n                          </div>\n                      </div>\n                    </div><footer class="sticky-footer w-100 text-center">\n                      <p class="mb-0 font-weight-bold">Araa Consultancy and Studies</p>\n                      <p class="mb-0">Unit 201, DBCS Building Al Gar houd 13866 Dubai 941, Tel: +971 ---------------</p>\n                      <p class="mb-0">Email: ahmedalnajjar@ahmedalnajjar.com web: www.ahmedalnajjar.com</p>\n                  </footer>'}function renderPtDetails(t){return sessionStorage.setItem("pt-email",t.email),htmlContent=`<div class="row">\n    <div class="col-md-12 col-lg-5">\n        <p class="mb-1"><strong>Patient Name: </strong>${getUserName(t)}</p>\n        <p class="mb-1"><strong>Patient Email: </strong> ${t.email}</p>\n        <p class="mb-1"><strong>Sex: </strong> ${null!=t.gender?t.gender:"-"}</p>\n        <p class="mb-1"><strong>Emirates ID: </strong> ${null!=t.preferred_name?t.preferred_name:"-"}</p>\n        <p class="mb-1"><strong>Age: </strong> ${findAge(t.birthdate)}</p>\n        <p class="mb-1"><strong>DOB: </strong> ${null!=t.birthdate?t.birthdate:"-"}</p>\n    </div>\n    <div class="col-12 col-md-8 col-lg-5">\n        <p class="mb-1"><strong>Nationality: </strong>${null!=t.locale?t.locale:"-"}</p>\n        <p class="mb-1"><strong>Patient Type</strong> -</p>\n        <p class="mb-1"><strong>Mobile No: </strong>${null!=t.phone_number?t.phone_number:"-"}</p>\n        <p class="mb-1"><strong>Start Time: </strong> - </p>\n        <p class="mb-1"><strong>End Time: </strong> - </p>\n    </div>\n    <div class="col-sm-12 col-md-auto order-sm-1">\n        <div class="w-100 text-center p-2"><img style="width: 125px;height: 125px;" src=${null!=t.picture?t.picture:"../assets/img/user.svg"} /></div>\n    </div>\n</div>`,htmlContent}$(document).on("click",".action, a",(function(t){var e=$(this).data("action"),n=$(this).data("id");if(console.log("action - ",e,n),"profile"===e&&getResponse("/admin/users",{filter_name:"sub",filter_value:n},userProfileModal),"confirm"===e&&confirmAppointment(n),"invoice"===e&&showInvoice(n),"reschedule"===e&&rescheduleAppointment(n),"forms"===e&&(console.log("submit form"),submitForms(this)),"pt-dashboard"===e&&(event_id=$(this).data("eid"),openPatientDashboard(n,event_id)),"pt-dashboard-home"===e&&ptDashboardInit(),"view-forms"===e&&ptViewFormsSection(),"view-form"===e){ptShowForm($(this).data("formType"),$(this).data("created"))}if("visit-details"===e&&ptVisitDetailsSection(),"user-reports"===e&&ptUserReportsSection(),"view-user-report"===e){ptShowUserReport($(this).data("created"))}})),$(".print").on("click",(function(t){window.frames.printContent.print()})),$("#patient-select").select2({placeholder:"Select a Patient",width:"75%",ajax:{delay:250,url:ENDPOINT+"/admin/users",data:function(t){var e={filter_name:$("#patient-filter-name").val(),filter_value:t.term,limit:10};return"query:append"===t._type&&""!=sessionStorage.getItem("patient_select_pagination_token")&&(e.PaginationToken=sessionStorage.getItem("patient_select_pagination_token"),sessionStorage.setItem("patient_select_pagination_token","")),e},processResults:function(t){t.hasOwnProperty("PaginationToken")?sessionStorage.setItem("patient_select_pagination_token",t.PaginationToken):sessionStorage.setItem("patient_select_pagination_token","");var e=[],n=$("#patient-filter-name").val();return e.push({id:"",text:"All"}),t.data.forEach((function(t,s){e.push({id:t.sub,text:t[n]})})),{results:e}}}}),$("#form-reset").on("click",(function(){$("#patient-select").empty()})),$("#patient-select").on("select2:select",(function(t){var e=t.params.data.id,n=ENDPOINT+"/admin/users?filter_name=sub&filter_value="+e;$.get(n,(function(t){$("#patient-email").val(t.data[0].email)}))}));