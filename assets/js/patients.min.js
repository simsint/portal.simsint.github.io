var users={init:function(){users.getUsers({order_by:"given_name"})},getUsers:function(e){asyncResponse("GET","/admin/users",e,s=>{sessionStorage.setItem("users_paging_token",null!=s.paginationToken?s.PaginationToken:""),(e.hasOwnProperty("given_name")||e.hasOwnProperty("userid")||e.hasOwnProperty("middle_name")||e.hasOwnProperty("email"))&&$("#users-list").html(""),s.Items.forEach(e=>{$("#users-list").append(renderUserHtml(e))})})}};function renderUsersList(){}function uploadFile(e,s){$("#"+s).croppie("result",{type:"blob",size:"viewport"}).then((function(r){let n=r;$.ajax({url:e,type:"PUT",data:n,contentType:"image/jpeg",processData:!1,cache:!1,error:function(e){console.error("error",e),dangerToast("Error While Upload Images")},success:function(e){console.log("success -"+s,e)}})}))}users.init(),$("#users-list").html(""),$("#users-filter-form").on("submit",(function(e){e.preventDefault();let s=form2js(this,".",!0,null);console.log(s),"email"===s.filter_name||"preferred_username"===s.filter_name?s.userid=s.filter_value:s[s.filter_name]=$(`#patient-select option[value='${s.filter_value}']`).text(),s.order_by="given_name",console.log(s),users.getUsers(s)})),$("#send-invite").change((function(){this.checked?$("#send-invite-email,#send-invite-sms").removeAttr("disabled"):$("#send-invite-email, #send-invite-sms").attr("disabled","disabled")})),1==$("#send-invite-sms").prop("checked")&&$("#new-user-phone").val(),$("#create-user").on("submit",(function(e){if(e.preventDefault(),1==$("#send-invite").prop("checked")&&1==$("#send-invite-sms").prop("checked")&&""==$("#new-user-phone").val())return void $(".error-msg").removeClass("d-none").html("You must enter a phone number if SMS is checked as a desired delivery medium.");let s=form2js("create-user",".",!0,null);null!=s.phone_number&&(s.phone_number="+"+$(".tel-phone-input").intlTelInput("getSelectedCountryData").dialCode+s.phone_number),asyncResponse("POST","/admin/users",s,e=>{if(201!=e.statusCode||e.hasOwnProperty("message"))return $(".error-msg").removeClass("d-none").html(e.message),void dangerToast("Unable to Create User");$(".modal").modal("hide"),successToast("Successfully created new user"),$("#create-user").trigger("reset")})})),$("#update-user").on("submit",(function(e){e.preventDefault();let s=form2js("update-user",".",!0,null);null!=s.phone_number&&(s.phone_number="+"+$(".tel-phone-input").intlTelInput("getSelectedCountryData").dialCode+s.phone_number),asyncResponse("PUT","/admin/users",s,e=>{200!=e.statusCode||e.hasOwnProperty("message")?$(".error-msg").removeClass("d-none").html(e.message):(e.hasOwnProperty("custom:emirates_id_front")&&uploadFile(e["custom:emirates_id_front"],"emirates_id_front_preview"),e.hasOwnProperty("custom:emirates_id_back")&&uploadFile(e["custom:emirates_id_back"],"emirates_id_back_preview"),e.hasOwnProperty("profile")&&uploadFile(e.profile,"profile_preview"),$(".modal").modal("hide"),successToast("Successful"),$("form#update-user").trigger("reset"))})}));