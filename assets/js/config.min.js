window._config={cognito:{userPoolId:"us-east-1_InedFezwr",region:"us-east-1",clientId:"2g2q4svd2pg3lro7jv9ae5q59h"}};let poolData={UserPoolId:_config.cognito.userPoolId,ClientId:_config.cognito.clientId};const CORS="",ENDPOINT="https://api.ahmedalnajjar.com/dev",bootstrapCDN='<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css">',style="<style>\n                @media print {\n                  .sticky-footer {\n                      position: fixed;\n                      bottom: 0;\n                  }\n                }\n              </style>";if(null!=document.querySelector("iframe")){function resizeIframe(e){e.style.height=e.contentWindow.document.body.offsetHeight+"px",e.scrolling="no"}document.querySelector("iframe").addEventListener("load",resizeIframe)}function successToast(e){$.toast({icon:"success",text:`<p class='p-3'>${e}</p>`,delay:"3000",position:"top-right",dismissible:!1})}function warningToast(e){$.toast({icon:"warning",text:`<p class='p-3'>${e}</p>`,delay:"3000",position:"top-right",dismissible:!1})}function dangerToast(e){$.toast({icon:"danger",text:`<p class='p-3'>${e}</p>`,delay:"3000",position:"top-right",dismissible:!1})}function submitForms(e){console.log(form2js("forms",".",!0,null));var t=form2js("forms",".",!0,null);null!=t.phone_number&&(t.phone_number="+"+$(".tel-phone-input").intlTelInput("getSelectedCountryData").dialCode+t.phone_number),t.email=sessionStorage.getItem("pt-email"),console.log(t),$.ajax({url:`${ENDPOINT}/users/${sessionStorage.getItem("pid")}/forms`,method:"POST",contentType:"application/json",data:JSON.stringify(t),processing:!1}).done((function(e){console.log(e),successToast("Submitted Successfully")})).fail((function(e){console.log(e)}))}function ptRenderChecklist(e){console.log("render-form -",e),200==e.statusCode&&(console.log("success "),drawChart(e.body.Items[0].survey))}function ptShowUserReport(e){getResponse(`/users/${sessionStorage.getItem("pid")}/checklist`,{email:sessionStorage.getItem("pt-email"),created:e},ptRenderChecklist)}function ptViewUserReportsList(e){$("#user-report-list").html(""),e.body.Items.forEach(e=>{$(`<li class="p-3 text-white text-uppercase mb-1 pointer action" style="background-color: #b5b5b5;" data-action="view-user-report" data-created="${e.created}">\n          <span>${moment(e.created).format("LLL")}</span>\n        </li>`).appendTo("#user-report-list")})}function ptUserReportsSection(){$(".sections").addClass("d-none"),$(".sections.view-user-reports").removeClass("d-none"),getResponse(`/users/${sessionStorage.getItem("pid")}/checklist`,{email:sessionStorage.getItem("pt-email")},ptViewUserReportsList)}function ptShowVisitDetails(e,t){getResponse(`/users/${sessionStorage.getItem("pid")}/forms`,{email:sessionStorage.getItem("pt-email"),form_type:e,created:t},(function(e){e.body.Items[0].form_data;$("#visit-detail-iframe").css("display","none"),$("#visit-detail").css("display","block"),$("#visit-detail").html(ptRenderForm(e))}))}function ptViewVisitDetailsList(e){$("#visit-details-list").html(""),e.body.Items.forEach(e=>{$(`<li class="p-3 text-white text-uppercase mb-1 pointer action" style="background-color: #b5b5b5;" data-action="view-visit-details" data-form-type='${e.form_type}' data-created="${e.created}">\n          <span>${moment(e.created).format("LLL")}</span>\n        </li>`).appendTo("#visit-details-list")})}function ptVisitDetailsSection(){$("#visit-detail-iframe").css("display","block"),$("#visit-detail").css("display","none"),$(".sections").addClass("d-none"),$(".sections.view-visit-details").removeClass("d-none"),$("#visit-detail-iframe").attr("src","../forms/visit-report-form.html"),getResponse(`/users/${sessionStorage.getItem("pid")}/forms`,{email:sessionStorage.getItem("pt-email"),form_type:"visit_report_form"},ptViewVisitDetailsList)}function renderFilledDetails(e){let t="";delete e.email,delete e.form_type;for(const[n,s]of Object.entries(e))n.includes("file")||(n.includes("signature")&&!n.includes("date")?t+=`<p class="mb-1 bg-secoundary" style="font-size:18px"><span class="font-weight-bold text-capitalize" style="">${n.replaceAll("_"," ")}&nbsp: &nbsp</span> <img src="${s}" style="height:auto;width:350px;" /></p>`:t+=`<p class="mb-1 bg-secoundary" style="font-size:18px"><span class="font-weight-bold text-capitalize" style="">${n.replaceAll("_"," ")}&nbsp: &nbsp</span> ${s}</p>`);return t}function ptRenderForm(e){var t=e.body.Items[0].form_data;e.body.Items[0].form_type;return renderFilledDetails(t)}function ptShowForm(e,t){getResponse(`/users/${sessionStorage.getItem("pid")}/forms`,{email:sessionStorage.getItem("pt-email"),form_type:e,created:t},(function(e){$("#user-report-data").html(ptRenderForm(e))}))}function ptViewFormsList(e){$("#forms-list").html(""),e.body.Items.forEach(e=>{$(`<li class="p-3 text-white text-uppercase mb-1 pointer action" style="background-color: #b5b5b5;" data-action="view-form" data-form-type='${e.form_type}' data-created="${e.created}">\n          <span class="d-block mb-1 text-uppercase font-weight-bold">${e.form_type.replaceAll("_"," ")}</span>\n          <span>${moment(e.created).format("LLL")}</span>\n        </li>`).appendTo("#forms-list")})}function ptViewFormsSection(){$(".sections").addClass("d-none"),$(".sections.view-forms").removeClass("d-none"),getResponse(`/users/${sessionStorage.getItem("pid")}/forms`,{email:sessionStorage.getItem("pt-email")},ptViewFormsList)}function confirmAppointment(e){$.showConfirm({title:"Appointment Confirmation",body:"Do you want to confirm this appointment",textTrue:"CONFIRM",textFalse:"CANCEL",onSubmit:function(e){e&&$.toast({icon:"success",text:"<p class='p-3'>Appointment Confirmed</p>",delay:"3000",position:"top-right",dismissible:!1})}})}function showInvoice(e){getResponse("/admin/users",{filter_name:"sub",filter_value:e},null);var t=`<html><head>${bootstrapCDN}${style}</head><body>${renderInvoice()}</body></html>`;$.showModal({title:"INVOICE <button class='btn btn-sm btn-primary position-absolute print' style='right:50px;'>PRINT</button>",body:`<iframe id="printContent" name="printContent" height="500" srcdoc='${t}'></iframe>`});$("iframe#printContent").height();var n=$("iframe#printContent").parent().height(500);console.log(n)}function openPatientDashboard(e,t){window.location.href=`./patient/pt-dashboard.html?pid=${e}&eid=${t}`}function userProfileModal(e){$.showModal({title:"USER PROFILE",body:renderUserHtml(e.data[0])})}function getResponse(e,t,n){$.ajax({url:""+ENDPOINT+e,type:"get",dataType:"json",data:t,contentType:"application/json"}).done((function(e){n(e)})).fail((function(e){console.log("error -",e)}))}function getSyncResponse(e,t){$.ajax({url:""+ENDPOINT+e,type:"get",dataType:"json",data:t,async:!1,contentType:"application/json"}).done((function(e){return e})).fail((function(e){return console.log("error -",e),e}))}function findAge(e){return moment().diff(e,"years",!1)}function getUserName(e){return`${null!=e.given_name?e.given_name+" ":""}\n  ${null!=e.middle_name?e.middle_name+" ":""}\n  ${null!=e.family_name?e.family_name+" ":""}`}function renderUserHtml(e){return`<div class="row m-2 py-3 small rounded shadow">\n  <div class="col-sm-auto text-center"><img class="w-100" src=${null!=e.picture?e.picture:"./assets/img/user.svg"} style="max-width: 100px;" /></div>\n  <div class="col">\n      <div class="row">\n          <div class="col">\n              <h5 class="text-capitalize mb-0 font-weight-bold">${getUserName(e)}</h5>\n              <p>${e.email}</p>\n              <p class="mb-0"><strong>DOB</strong>:  ${null!=e.birthdate?e.birthdate:"-"}</p>\n              <p class="mb-0"><strong>Age</strong>: ${null!=e.birthdate?findAge(e.birthdate):"-"} Years</p>\n          </div>\n          <div class="col">\n              <p class="mb-0"><strong>Nationality</strong>: ${null!=e.locale?e.locale:"-"}</p>\n              <p class="mb-0"><strong>Phone</strong>: ${null!=e.phone_number?e.phone_number:"-"}</p>\n              <p class="mb-0"><strong>Address</strong>: ${null!=e.address?e.address:"-"}</p>\n              <p class="mb-0"><strong>Emirates ID</strong>: ${null!=e.preferred_username?e.preferred_username:"-"}</p>\n              <button class="btn btn-outline-primary action btn-sm m-1" type="button" data-action="pt-dashboard" data-id='${e.sub}'>PATIENT DASHBOARD</button>\n              <a class="btn btn-outline-primary btn-sm" href="#collapse-${e.sub}" role="button" aria-expanded="true" aria-controls="collapse-${e.sub}" data-toggle="collapse">View Emirates ID</a></div>\n      </div>\n  </div>\n  <div class="col-12 collapse" id="collapse-${e.sub}">\n      <div class="row mt-2">\n          <div class="col-sm-12 col-md-6 text-center"><img class="img-fluid" src="${emiratesResolver(e.email)}" /></div>\n          <div class="col-sm-12 col-md-6 text-center"><img class="img-fluid" src="${emiratesResolver2(e.phone_number)}" /></div>\n      </div>\n  </div>\n</div>`}function emiratesResolver(e){return"ykuk88@gmail.com"===e?"./assets/img/emirids/eidf_1612582523905.jpeg":"sod@simsint.com"===e?"./assets/img/emirids/eidf_1612582523906.jpeg":"./assets/img/card-holder.png"}function emiratesResolver2(e){return"+971508444797"===e?"./assets/img/emirids/eidb_1612582523905.jpeg":"+971585871430"===e?"./assets/img/emirids/eidb_1612582523906.jpeg":"./assets/img/card-holder.png"}function eventTimeToString(e,t){return`${moment(e).format("LL")} - ${moment(t).format("LT")}`}function serviceDetails(e){return`${null!=e.service_type?e.service_type+" | ":""} \n  ${null!=e.service_amount?""+e.service_amount:""}\n  ${null!=e.service_currency?e.service_currency+" | ":""}\n  ${null!=e.service_duration?e.service_duration+" min | ":""}\n  ${null!=e.service_desc?e.service_desc+" ":""};\n  `}function renderAppointmentHtml(e){return htmlContent=`<div class="row m-1 py-3 small rounded shadow" >\n    <div class="col">\n        <div class="row">\n            <div class="col">\n                <p class="font-weight-bold mb-0" style="font-size:1rem;">Meeting with ${e.extendedProperties.private.patient_email||"-"}</p>\n                <p class="mb-2">${eventTimeToString(e.start.dateTime,e.end.dateTime)}</p>\n            </div>\n            <div class="col-auto">\n                <p class="mb-1"><strong>File No. </strong> ${e.extendedProperties.private.file_no}</p>\n            </div>\n        </div>\n        <p class="mb-1"><strong>Chief Complaint: </strong> ${e.extendedProperties.private.chief_complaint||"-"}</p>\n        <p class="mb-1"><strong>Location: </strong> ${e.location||"-"}</p>\n        <p class="mb-1"><strong>Service Details: </strong> ${serviceDetails(e.extendedProperties.private)} \n        </p>`,e.organizer.email==e.extendedProperties.private.creator_email?htmlContent+=`<p class="mb-0"><strong>Doctor: </strong>${e.organizer.displayName||e.organizer.email}</p>`:htmlContent+=`<p class="mb-0"><strong>Doctor: </strong>${e.organizer.email}</p>\n                    <p class="mb-1">Created By ${e.organizer.displayName||e.organizer.email}</p>`,htmlContent+=`<div class="row">\n                    <div class="col">\n                        <p class="mb-1"><strong>Status: </strong>${e.extendedProperties.private.status}</p>`,null!=e.extendedProperties.private.meeting_link&&(htmlContent+=`<p class="mb-1"><strong>Meeting: </strong><a href="${e.extendedProperties.private.meeting_link}" target="_blank" >Start Meeting</a></p>`),htmlContent+="</div>",htmlContent+='  <div class="col">',null!=e.extendedProperties.private.payment_ref&&(htmlContent+=`    <p class="mb-1"><strong>Payment Ref: </strong> ${e.extendedProperties.private.payment_ref} </p>`),null!=e.extendedProperties.private.amount&&(htmlContent+=`    <p class="mb-1"><strong>Payment Type: </strong> ${e.extendedProperties.private.payment_type} </p>`),htmlContent+="   </div>",htmlContent+=`</div>\n                <button class="btn btn-outline-primary action btn-sm m-1" type="button" data-action="profile" data-id='${e.extendedProperties.private.patient_id}'>USER PROFILE</button>`,"pending"==e.extendedProperties.private.status&&(htmlContent+=`<button class="btn btn-outline-primary action btn-sm m-1" type="button" data-action="confirm" data-id='${e.id}'>CONFIRM</button>`),null!=e.extendedProperties.private.payment_status&&"paid"==e.extendedProperties.private.payment_status&&(htmlContent+=`<button class="btn btn-outline-primary action btn-sm m-1" type="button" data-action="invoice" data-id='${e.id}' >INVOICE</button>`),htmlContent+=`<button class="btn btn-outline-primary action btn-sm m-1" type="button" data-action="reschedule" data-id='${e.id}'>RESCHEDULE</button>\n                <button class="btn btn-outline-primary action btn-sm m-1" type="button" data-action="pt-dashboard" data-id='${e.extendedProperties.private.patient_id}' data-eid='${e.id}'>PATIENT DASHBOARD</button>\n                </div>\n        </div>`,htmlContent}function renderInvoice(e){return'<footer class="sticky-footer w-100 text-center">\n                      <p class="mb-0 font-weight-bold">Araa Consultancy and Studies</p>\n                      <p class="mb-0">Unit 201, DBCS Building Al Gar houd 13866 Dubai 941, Tel: +971 ---------------</p>\n                      <p class="mb-0">Email: ahmedalnajjar@ahmedalnajjar.com web: www.ahmedalnajjar.com</p>\n                  </footer>','<div class="row">\n                      <div class="col-12 text-center"><img src="./assets/img/araa-consultancy-and-studies-logo.png" />\n                          <p class="mb-0">Experience Most Compassionate Healthcare in UAE</p>\n                          <p class="mb-0">Under the</p>\n                          <p class="font-weight-bold mb-5">Leadership of Dr. Ahmed Alnajjar</p>\n                      </div>\n                      <div class="col-12">\n                          <div class="row mb-5">\n                              <div class="col">\n                                  <p>Name: Mohammed Salman</p>\n                                  <p>Email : mohammedsalman0258@gmail.com</p>\n                                  <p>Age: 41 Years</p>\n                                  <p>Appointment : 30/1/2021 03:00 PM - 3:30 PM</p>\n                                  <p>Chief Complaint : Depression</p>\n                              </div>\n                              <div class="col-auto">\n                                  <p>File No. 168254858774</p>\n                                  <p>Doctor: Dr. Ahmed Alnajjar</p>\n                              </div>\n                          </div>\n                          <div class="table-responsive">\n                              <table class="table">\n                                  <thead>\n                                      <tr>\n                                          <th>Description</th>\n                                          <th>Price</th>\n                                      </tr>\n                                  </thead>\n                                  <tbody>\n                                      <tr>\n                                          <td>Video Call</td>\n                                          <td>500 AED</td>\n                                      </tr>\n                                  </tbody>\n                                  <tfoot>\n                                      <tr>\n                                          <td>Total</td>\n                                          <td>500 AED</td>\n                                      </tr>\n                                  </tfoot>\n                              </table>\n                          </div>\n                      </div>\n                    </div><footer class="sticky-footer w-100 text-center">\n                      <p class="mb-0 font-weight-bold">Araa Consultancy and Studies</p>\n                      <p class="mb-0">Unit 201, DBCS Building Al Gar houd 13866 Dubai 941, Tel: +971 ---------------</p>\n                      <p class="mb-0">Email: ahmedalnajjar@ahmedalnajjar.com web: www.ahmedalnajjar.com</p>\n                  </footer>'}function renderPtDetails(e){return sessionStorage.setItem("pt-email",e.email),htmlContent=`<div class="row">\n    <div class="col-md-12 col-lg-5">\n        <p class="mb-1"><strong>Patient Name: </strong>${getUserName(e)}</p>\n        <p class="mb-1"><strong>Patient Email: </strong> ${e.email}</p>\n        <p class="mb-1"><strong>Sex: </strong> ${null!=e.gender?e.gender:"-"}</p>\n        <p class="mb-1"><strong>Emirates ID: </strong> ${null!=e.preferred_username?e.preferred_username:"-"}</p>\n        <p class="mb-1"><strong>Age: </strong> ${findAge(e.birthdate)}</p>\n        <p class="mb-1"><strong>DOB: </strong> ${null!=e.birthdate?e.birthdate:"-"}</p>\n    </div>\n    <div class="col-12 col-md-8 col-lg-5">\n        <p class="mb-1"><strong>Nationality: </strong>${null!=e.locale?e.locale:"-"}</p>\n        <p class="mb-1"><strong>Patient Type</strong> -</p>\n        <p class="mb-1"><strong>Mobile No: </strong>${null!=e.phone_number?e.phone_number:"-"}</p>\n        <p class="mb-1"><strong>Start Time: </strong> - </p>\n        <p class="mb-1"><strong>End Time: </strong> - </p>\n    </div>\n    <div class="col-sm-12 col-md-auto order-sm-1">\n        <div class="w-100 text-center p-2"><img style="width: 125px;height: 125px;" src=${null!=e.picture?e.picture:"../assets/img/user.svg"} /></div>\n    </div>\n</div>`,htmlContent}function regexGetBodyContent(e){var t=e.match(/<form.*?>([\s\S]*)<\/form>/gim);return console.log("bodytag - ",t),bodyContents=t[0],bodyContents}$(document).on("click",".action, a",(function(e){var t=$(this).data("action"),n=$(this).data("id");if(console.log("action - ",t,n),"profile"===t&&getResponse("/admin/users",{filter_name:"sub",filter_value:n},userProfileModal),"confirm"===t&&confirmAppointment(n),"invoice"===t&&showInvoice(n),"reschedule"===t&&rescheduleAppointment(n),"forms"===t&&(console.log("submit form"),submitForms(this)),"pt-dashboard"===t&&(event_id=$(this).data("eid"),openPatientDashboard(n,event_id)),"pt-dashboard-home"===t&&ptDashboardInit(),"view-forms"===t&&ptViewFormsSection(),"view-form"===t){ptShowForm($(this).data("formType"),$(this).data("created"))}if("visit-details"===t&&ptVisitDetailsSection(),"view-visit-details"===t){ptShowVisitDetails($(this).data("formType"),$(this).data("created"))}if("user-reports"===t&&ptUserReportsSection(),"view-user-report"===t){ptShowUserReport($(this).data("created"))}})),$(".print").on("click",(function(e){window.frames.printContent.print()})),$("#patient-select").select2({placeholder:"Select a Patient",width:"75%",ajax:{delay:250,url:ENDPOINT+"/admin/users",data:function(e){var t={filter_name:$("#patient-filter-name").val(),filter_value:e.term,limit:10};return"query:append"===e._type&&""!=sessionStorage.getItem("patient_select_pagination_token")&&(t.PaginationToken=sessionStorage.getItem("patient_select_pagination_token"),sessionStorage.setItem("patient_select_pagination_token","")),t},processResults:function(e){e.hasOwnProperty("PaginationToken")?sessionStorage.setItem("patient_select_pagination_token",e.PaginationToken):sessionStorage.setItem("patient_select_pagination_token","");var t=[],n=$("#patient-filter-name").val();return t.push({id:"",text:"All"}),e.data.forEach((function(e,s){t.push({id:e.sub,text:e[n]})})),{results:t}}}}),$("#form-reset").on("click",(function(){$("#patient-select").empty()})),$("#patient-select").on("select2:select",(function(e){var t=e.params.data.id,n=ENDPOINT+"/admin/users?filter_name=sub&filter_value="+t;$.get(n,(function(e){$("#patient-email").val(e.data[0].email)}))}));let surveyData="";function drawChart(e){console.log(e),surveyData=e;var t={};let n=[],s=[];null!=e&&($.each(e.sections,(function(e,o){let i=o.totalQuestions/(5*o.totalQuestions),a=0;$.each(o.questions,(function(e,n){a+=n.value*i,t[n.en]=n.value}));let r=100*a/o.totalQuestions;"scale"===o.sectionType&&(n.push(o.title.en),s.push(parseFloat(r.toFixed(1))))})),updateChart(n,s)),jQuery.isEmptyObject(e)||$("#check-list-graph").removeClass("d-none"),jQuery.isEmptyObject(t)||fillSurvey(t)}function fillSurvey(e){$("#user-report-questions").removeClass("d-none"),$("#filledSurvey").html(surveyContent),showTab(currentTab),js2form(document.getElementById("filledSurvey"),e)}function updateChart(e,t){let n=document.querySelector("#user-report-chart canvas").chart;n.data.labels=e,n.data.datasets[0].data=t,n.update()}$(window).resize((function(){drawChart(surveyData)}));